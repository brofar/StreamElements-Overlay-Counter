// In case we want to extend this later.
const trackedCounters = ["scares"];

// Initial page load
window.addEventListener('onWidgetLoad', function (obj) {
  trackedCounters.forEach(name => {
    SE_API.counters.get(name).then(counter => updateCounter(name, counter.count))
      .catch(error => {
        document.getElementById(`counter-${name}`).innerHTML = "Err";
      });
  });
});

// When scares are updated
window.addEventListener('onEventReceived', function (obj) {
  const listener = obj.detail.listener;
  const data = obj.detail.event;

  if (listener === 'bot:counter' && trackedCounters.includes(data.counter)) {
    updateCounter(data.counter, data.value);
  }
});

function updateCounter(name, value) {
  // --- Glitch Effect Control ---
  const glitchElement = document.getElementById("glitch");

  // Remove the 'hidden' class
  glitchElement.classList.remove("hidden");
  document.getElementById(`counter-${name}`).innerHTML = value;

  setTimeout(() => {
    glitchElement.classList.add("hidden"); // Re-add the 'hidden' class after 1 second
  }, 1000);
}
